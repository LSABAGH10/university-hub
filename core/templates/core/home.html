{% extends 'base.html' %}
{% block title %}الرئيسية{% endblock %}

{% block extra_head %}
<style>
    .hero-section {
        position: relative;
        background-image: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('https://images.unsplash.com/photo-1522202176988-66273c2fd55f?q=80&w=2071&auto=format&fit=crop');
        background-size: cover;
        background-position: center;
        padding: 8rem 0;
        color: white;
    }
    .quotes-section {
        background-color: var(--bs-tertiary-bg, #e9ecef);
        padding: 2rem 0;
        font-style: italic;
        font-size: 1.2rem;
        height: 80px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    #quote-text {
        transition: opacity 0.5s ease-in-out;
    }
    #quote-text.fade-out {
        opacity: 0;
    }
    .stats-section, .features-section, .about-section, .testimonials-section, .carousel-section, .countdown-section, .final-cta, .partners-section, .news-section {
        padding: 4rem 0;
    }
    .stat-item, .feature-card {
        text-align: center;
    }
    .stat-number {
        font-size: 3.5rem;
        font-weight: 700;
        color: var(--bs-primary);
    }
    .stat-title {
        font-size: 1.2rem;
        color: var(--bs-secondary-color);
    }
    .feature-card i { font-size: 2.5rem; color: var(--bs-primary); }
    .carousel-inner img {
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .countdown-section {
        background-color: var(--bs-primary);
        color: white;
    }
    .countdown-timer {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
    }
    .countdown-item {
        background-color: rgba(0,0,0,0.2);
        padding: 20px;
        border-radius: 10px;
        min-width: 100px;
    }
    .countdown-number {
        font-size: 3rem;
        font-weight: 700;
    }
    .partner-logo {
        max-height: 60px;
        filter: grayscale(100%);
        opacity: 0.6;
        transition: all 0.3s ease-in-out;
    }
    .partner-logo:hover {
        filter: grayscale(0%);
        opacity: 1;
        transform: scale(1.1);
    }
</style>
{% endblock %}

{% block content %}
    <div class="hero-section text-center">
        <div class="container hero-content">
            <h1 class="display-4 fw-bold">منصتك الجامعية المتكاملة</h1>
            <p class="lead col-lg-8 mx-auto">كل ما تحتاجه للنجاح في مكان واحد.</p>
            
            <div class="row justify-content-center mt-4">
                <div class="col-lg-8">
                    <form id="demo-search-form">
                        <div class="input-group input-group-lg">
                            <input type="text" id="demo-search-input" class="form-control" placeholder="جرّب البحث عن مقرر، ملخص، أو سؤال..." aria-label="Search">
                            <button class="btn btn-primary" type="submit"><i class="bi bi-search"></i> ابحث</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="resultsModal" tabindex="-1" aria-labelledby="resultsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="resultsModalLabel">نتائج البحث التجريبي</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
                    <h4 class="my-3">محتوى رائع في انتظارك!</h4>
                    <p id="modal-text-result">وجدنا نتائج لكلمة البحث الخاصة بك. سجل الآن للوصول الكامل.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <a href="{% url 'register' %}" class="btn btn-success">أنشئ حساباً مجانياً</a>
                    <a href="{% url 'login' %}" class="btn btn-outline-primary">تسجيل الدخول</a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="quotes-section text-center">
        <div class="container">
            <p id="quote-text">🌟 "اطلبوا العلم من المهد إلى اللحد."</p>
        </div>
    </div>

    <div class="stats-section">
         <div class="container">
            <div class="row">
                <div class="col-md-4 stat-item">
                    <h2 class="stat-number" data-target="{{ student_count }}">0</h2>
                    <p class="stat-title">👨‍🎓 طالب مسجل</p>
                </div>
                <div class="col-md-4 stat-item">
                    <h2 class="stat-number" data-target="{{ course_count }}">0</h2>
                    <p class="stat-title">📚 مقرر دراسي</p>
                </div>
                <div class="col-md-4 stat-item">
                    <h2 class="stat-number" data-target="{{ material_count }}">0</h2>
                    <p class="stat-title">📄 ملف وملخص</p>
                </div>
            </div>
        </div>
    </div>

    <div class="features-section text-center bg-light">
        <div class="container">
            <h2 class="mb-5">لماذا تختار منصتنا؟</h2>
            <div class="row g-4">
                <div class="col-lg-4"><div class="feature-card card h-100"><i class="bi bi-collection-play-fill mb-3"></i><h3>محتوى شامل ومنظم</h3><p>نجمع لك كل فيديوهات الشرح والمواد التعليمية وننظمها لسهولة الوصول.</p></div></div>
                <div class="col-lg-4"><div class="feature-card card h-100"><i class="bi bi-people-fill mb-3"></i><h3>مجتمع تفاعلي</h3><p>اطرح الأسئلة واحصل على إجابات من زملائك. شارك خبراتك وساعد الآخرين.</p></div></div>
                <div class="col-lg-4"><div class="feature-card card h-100"><i class="bi bi-briefcase-fill mb-3"></i><h3>بوابتك للمستقبل</h3><p>نوفر لك قسماً خاصاً بأحدث فرص التدريب والوظائف لبناء مسيرتك المهنية.</p></div></div>
            </div>
        </div>
    </div>

    <div class="news-section bg-white">
        <div class="container">
            <h2 class="text-center pb-2 border-bottom mb-5">آخر الأخبار والتنبيهات</h2>
            <div class="row g-4">
                {% for article in articles %}
                    <div class="col-md-4">
                        <div class="card shadow-sm h-100">
                            <div class="card-body">
                                <h5 class="card-title">{{ article.title }}</h5>
                                <p class="card-text text-muted"><small>{{ article.published_date|date:"d M Y" }}</small></p>
                                <p class="card-text">{{ article.content|truncatewords:20 }}</p>
                                <a href="#" class="btn btn-sm btn-outline-primary">اقرأ المزيد</a>
                            </div>
                        </div>
                    </div>
                {% empty %}
                    <p class="text-center">لا توجد أخبار حالياً.</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="countdown-section">
        <div class="container text-center">
            <h2 class="fw-bold">امتحانات نهاية الفصل الدراسي تبدأ خلال:</h2>
            <div class="countdown-timer">
                <div class="countdown-item"><div id="days" class="countdown-number">0</div><span>أيام</span></div>
                <div class="countdown-item"><div id="hours" class="countdown-number">0</div><span>ساعات</span></div>
                <div class="countdown-item"><div id="minutes" class="countdown-number">0</div><span>دقائق</span></div>
                <div class="countdown-item"><div id="seconds" class="countdown-number">0</div><span>ثواني</span></div>
            </div>
        </div>
    </div>

    <div class="carousel-section text-center">
        <div class="container">
            <h2 class="pb-2 border-bottom mb-5">جولة سريعة داخل المنصة</h2>
            <div id="screenshotsCarousel" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                    <div class="carousel-item active"><img src="https://placehold.co/1200x600/343a40/white?text=Dashboard" class="d-block w-100" alt="لوحة التحكم"></div>
                    <div class="carousel-item"><img src="https://placehold.co/1200x600/0d6efd/white?text=Course+Page" class="d-block w-100" alt="صفحة المقرر"></div>
                    <div class="carousel-item"><img src="https://placehold.co/1200x600/198754/white?text=Q&A+Section" class="d-block w-100" alt="قسم الأسئلة والأجوبة"></div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#screenshotsCarousel" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
                <button class="carousel-control-next" type="button" data-bs-target="#screenshotsCarousel" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
            </div>
        </div>
    </div>

    <div class="testimonials-section bg-light">
        <div class="container text-center">
            <h2 class="pb-2 border-bottom mb-5">ماذا يقول زملاؤك؟</h2>
            <div class="row">
                {% for testimonial in testimonials %}
                    <div class="col-md-6 mx-auto mb-4">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <p class="card-text fst-italic">"{{ testimonial.quote }}"</p>
                                <footer class="blockquote-footer mt-2">{{ testimonial.student_name }}, <cite>{{ testimonial.student_details }}</cite></footer>
                            </div>
                        </div>
                    </div>
                {% empty %}
                    <p>سيتم إضافة آراء الطلاب قريباً.</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="partners-section bg-white">
        <div class="container text-center">
            <h2 class="mb-5">شركاؤنا في النجاح</h2>
            <div class="row align-items-center">
                <div class="col-lg-2 col-md-4 col-6 mb-4"><img src="https://placehold.co/200x100/png?text=Partner+1" class="img-fluid partner-logo" alt="Partner 1"></div>
                <div class="col-lg-2 col-md-4 col-6 mb-4"><img src="https://placehold.co/200x100/png?text=Partner+2" class="img-fluid partner-logo" alt="Partner 2"></div>
                <div class="col-lg-2 col-md-4 col-6 mb-4"><img src="https://placehold.co/200x100/png?text=Partner+3" class="img-fluid partner-logo" alt="Partner 3"></div>
                <div class="col-lg-2 col-md-4 col-6 mb-4"><img src="https://placehold.co/200x100/png?text=Partner+4" class="img-fluid partner-logo" alt="Partner 4"></div>
                <div class="col-lg-2 col-md-4 col-6 mb-4"><img src="https://placehold.co/200x100/png?text=Partner+5" class="img-fluid partner-logo" alt="Partner 5"></div>
                <div class="col-lg-2 col-md-4 col-6 mb-4"><img src="https://placehold.co/200x100/png?text=Partner+6" class="img-fluid partner-logo" alt="Partner 6"></div>
            </div>
        </div>
    </div>
    
    <div class="final-cta text-center py-5">
        <div class="container">
            <h2 class="fw-bold">جاهز لتبدأ رحلتك نحو التفوق؟</h2>
            <a href="{% url 'register' %}" class="btn btn-success btn-lg mt-3 px-5">أنشئ حسابك المجاني الآن</a>
        </div>
    </div>
{% endblock %}

{% block extra_scripts %}
<script>
    // كود الاقتباسات المتغيرة
    const quoteTextElement = document.getElementById('quote-text');
    if (quoteTextElement) {
        const quotes = [
            '🌟 "اطلبوا العلم من المهد إلى اللحد."',
            '🌟 "المعرفة قوة." (Knowledge is power)',
            '🌟 "العلم يبني بيوتاً لا عماد لها، والجهل يهدم بيت العز والشرف."',
        ];
        let currentQuoteIndex = 0;
        function changeQuote() {
            quoteTextElement.classList.add('fade-out');
            setTimeout(() => {
                currentQuoteIndex = (currentQuoteIndex + 1) % quotes.length;
                quoteTextElement.innerHTML = quotes[currentQuoteIndex];
                quoteTextElement.classList.remove('fade-out');
            }, 500);
        }
        setInterval(changeQuote, 10000);
    }

    // كود عداد الإحصائيات
    const counters = document.querySelectorAll('.stat-number');
    counters.forEach(counter => {
        const animate = () => {
            const target = +counter.getAttribute('data-target');
            const count = +counter.innerText;
            const increment = target / 200;
            if (count < target) {
                counter.innerText = Math.ceil(count + increment);
                setTimeout(animate, 10);
            } else {
                counter.innerText = target;
            }
        }
        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    animate();
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.5 });
        observer.observe(counter);
    });

    // كود العد التنازلي
    const countdownTargetDate = new Date("Jan 1, 2026 09:00:00").getTime();
    const countdownFunction = setInterval(() => {
        const now = new Date().getTime();
        const distance = countdownTargetDate - now;
        const countdownTimerEl = document.querySelector(".countdown-timer");
        const countdownTitleEl = document.querySelector(".countdown-section h2");
        if(countdownTimerEl && countdownTitleEl) {
            if (distance < 0) {
                clearInterval(countdownFunction);
                countdownTitleEl.innerHTML = "الامتحانات بدأت! بالتوفيق للجميع.";
                countdownTimerEl.style.display = 'none';
            } else {
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                document.getElementById('days').innerText = days;
                document.getElementById('hours').innerText = hours;
                document.getElementById('minutes').innerText = minutes;
                document.getElementById('seconds').innerText = seconds;
            }
        }
    }, 1000);

    // كود البحث التجريبي
    const demoSearchForm = document.getElementById('demo-search-form');
    if (demoSearchForm) {
        const demoSearchInput = document.getElementById('demo-search-input');
        const resultsModal = new bootstrap.Modal(document.getElementById('resultsModal'));
        const modalTextResult = document.getElementById('modal-text-result');

        demoSearchForm.addEventListener('submit', function(event) {
            event.preventDefault(); 
            
            const searchTerm = demoSearchInput.value;
            if (searchTerm) {
                modalTextResult.innerHTML = `وجدنا عدة نتائج لكلمة البحث "<strong>${searchTerm}</strong>".<br>سجل الآن للوصول الكامل لكل المحتوى.`;
            } else {
                modalTextResult.innerHTML = `يوجد آلاف الملفات والمحاضرات في انتظارك.<br>سجل الآن للوصول الكامل لكل المحتوى.`;
            }
            
            resultsModal.show();
        });
    }
</script>
{% endblock %}